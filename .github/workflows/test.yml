name: Test

on: [push]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2

    - name: Run tests in docker container
      env:
        BAZEL_USER_ROOT: /home/runner/BAZEL_USER_ROOT
        OUTPUT_DIR: /home/runner/OUTPUT_DIR
        TUSHARE_TOKEN: ${{ secrets.TUSHARE_TOKEN }}
        TWEB_MINIO_ACCESS_KEY: ${{ secrets.TWEB_MINIO_ACCESS_KEY }}
        TWEB_MINIO_SECRET_KEY: ${{ secrets.TWEB_MINIO_SECRET_KEY }}
        TWEB_MINIO_HOST: ${{ secrets.TWEB_MINIO_HOST }}
        TWEB_MINIO_PORT: ${{ secrets.TWEB_MINIO_PORT }}
        TWEB_MINIO_SECURE: ${{ secrets.TWEB_MINIO_SECURE }}
        HEARTBEAT_SECONDS: ${{ secrets.HEARTBEAT_SECONDS }}
        JOB_LOG_DIR: $${{ secrets.JOB_LOG_DIR }}
        JOB_SHELL_DIR: $${{ secrets.JOB_SHELL_DIR}}


      run: docker-compose up --exit-code-from test test
